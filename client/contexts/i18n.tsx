import { createContext, useContext, useMemo, useState, PropsWithChildren, useEffect } from "react";

export type Locale =
  | "en" | "as" | "bn" | "brx" | "doi" | "gu" | "hi" | "kn" | "ks" | "kok"
  | "mai" | "ml" | "mni" | "mr" | "ne" | "or" | "pa" | "sa" | "sat" | "sd"
  | "ta" | "te" | "ur";

type Dict = Record<string, string>;

type I18nContextType = {
  locale: Locale;
  setLocale: (l: Locale) => void;
  t: (key: string) => string;
  languages: { code: Locale; name: string }[];
};

const enBase: Dict = {
  brand: "Krishi Yield",
  tagline: "Smart crop yield estimation for every farmer",
  heroCta: "Calculate Yield",
  cropType: "Crop type",
  selectCrop: "Select crop",
  rice: "Rice",
  wheat: "Wheat",
  maize: "Maize",
  others: "Others",
  fieldSize: "Field size",
  unit: "Unit",
  acres: "Acres",
  gunthas: "Gunthas",
  hectares: "Hectares",
  location: "Farmer's location",
  detectLocation: "Use GPS",
  orEnterManually: "or enter manually",
  locationPlaceholder: "Village, town or district",
  calculating: "Calculating...",
  resultsTitle: "Estimated crop yield",
  suggestionsTitle: "Suggestions to improve yield",
  fertilizerTips: "Balanced fertilizers based on soil test",
  irrigationTips: "Schedule irrigation at critical growth stages",
  rotationTips: "Practice crop rotation to enrich soil",
  share: "Share",
  reset: "Reset",
  gpsDenied: "Location permission denied. Please enter manually.",
  searchPrices: "Search crop prices",
  priceResults: "Current crop prices",
  market: "Market",
  state: "State",
  date: "Date",
  min: "Min",
  max: "Max",
  modal: "Modal",
  unitLabel: "Unit",
  mapTitle: "Location map",
  locating: "Locating...",
  locationNotFound: "Location not found",
  viewOnMap: "View on OpenStreetMap",
};

const dictionaries: Partial<Record<Locale, Dict>> = {
  en: enBase,
  bn: {
    ...enBase,
    tagline: "প্রতি কৃষকের জন্য স্মার্ট ফলন হিসাব",
    heroCta: "ফলন হিসাব করুন",
    cropType: "ফসলের ধরন",
    selectCrop: "ফসল নির্বাচন করুন",
    rice: "ধান",
    wheat: "গম",
    maize: "ভুট্টা",
    others: "অন্যান্য",
    fieldSize: "জমির আকার",
    unit: "একক",
    acres: "একর",
    gunthas: "গুঠা",
    hectares: "হেক্টর",
    location: "কৃষকের অবস্থান",
    detectLocation: "জিপিএস ব্যবহার করুন",
    orEnterManually: "অথবা হাতে লিখুন",
    locationPlaceholder: "গ্রাম, শহর বা জেলা",
    calculating: "হিসাব করা হচ্ছে...",
    resultsTitle: "আনুমানিক ফলন",
    suggestionsTitle: "ফলন বাড়াতে করণীয়",
    fertilizerTips: "মাটির পরীক্ষার ভিত্তিতে সুষম সার",
    irrigationTips: "গুরুত্বপূর্ণ ধাপে সেচ দিন",
    rotationTips: "ফসল পর্যায়ক্রম করুন",
    share: "শেয়ার",
    reset: "রিসেট",
    gpsDenied: "লোকেশন অনুমতি পাওয়া যায়নি। হাতে লিখুন।",
    searchPrices: "ফসলের দাম খুঁ���ুন",
    priceResults: "বর্তমান ফসলের দাম",
    market: "মার্কেট",
    state: "রাষ্ট্র",
    date: "তারিখ",
    min: "সর্বনিম্ন",
    max: "সর্বোচ্চ",
    modal: "মোডাল",
    unitLabel: "একক",
  },
  hi: {
    ...enBase,
    tagline: "हर किसान के लिए स्मार्ट फसल उपज अनुमान",
    heroCta: "उपज की गणना करें",
    cropType: "फसल का प्रकार",
    selectCrop: "फसल चुनें",
    rice: "चावल",
    wheat: "गेहूं",
    maize: "मक्का",
    others: "अन्य",
    fieldSize: "खेत का आकार",
    unit: "इकाई",
    acres: "एकड़",
    gunthas: "गुंठा",
    hectares: "हेक्टेयर",
    location: "किसान का स्थान",
    detectLocation: "जीपीएस उपयोग करें",
    orEnterManually: "या मैन्युअल रूप से दर्ज करें",
    locationPlaceholder: "गांव, शहर या जिला",
    calculating: "गणना हो रही है...",
    resultsTitle: "अनुमानित फसल उपज",
    suggestionsTitle: "उपज सुधारने के सुझाव",
    fertilizerTips: "मृदा जांच के आधार पर संतुलित उर्वरक",
    irrigationTips: "महत्वपूर्ण चरणों पर सिंचाई करें",
    rotationTips: "मिट्टी सुधार हेतु फसल चक्र अपनाएँ",
    share: "साझा करें",
    reset: "रीसेट",
    gpsDenied: "स्थान अनुमति अस्वीकार। कृपया मैन्युअल रूप से दर्ज करें।",
    searchPrices: "फसल कीमत खोजें",
    priceResults: "वर्तमान फसल कीमतें",
    market: "मार्केट",
    state: "राज्य",
    date: "तारीख",
    min: "न्यूनतम",
    max: "अधिकतम",
    modal: "मोड़ल",
    unitLabel: "इकाई",
  },
  ta: {
    ...enBase,
    tagline: "ஒவ்வொரு விவசாயிக்கும் ஸ்மார்ட் விளைச்சல் கணிப்பு",
    heroCta: "விளைச்சலை கணக்கிட",
    cropType: "பயிர் வகை",
    selectCrop: "பயிரைத் தேர்வு செய்யவும்",
    rice: "அரிசி",
    wheat: "கோதும��",
    maize: "சோளம்",
    others: "மற்றவை",
    fieldSize: "வேளாண் நில அளவு",
    unit: "அளவுகோல்",
    acres: "ஏக்கர்",
    gunthas: "குன்தா",
    hectares: "ஹெக்டேயர்",
    location: "விவசாயியின் இருப்பிடம்",
    detectLocation: "ஜிபிஎஸ் பயன்படுத்தவும்",
    orEnterManually: "அல்லது கைமுறையாக உள்ளிடவும்",
    locationPlaceholder: "கிராமம், நகரம் அல்லது மாவட்டம்",
    calculating: "கணக்கிடப்படுகிறது...",
    resultsTitle: "மதிப்பிடப்பட்ட பயிர் விளைச்சல்",
    suggestionsTitle: "விளைச்சலை மேம்படுத்த ஆலோசனைகள்",
    fertilizerTips: "மண் பரிசோதனை அடிப்படையில் சமநிலை உரங்கள்",
    irrigationTips: "முக்கிய வளர்ச்சி நிலையங்களில் பாசனம்",
    rotationTips: "மண்ணை வளப்படுத்த ப���ிர் மாற்றம்",
    share: "பகிர்",
    reset: "மீட்டமை",
    gpsDenied: "இருப்பிட அனுமதி மறுக்கப்பட்டது. கைமுறையாக உள்ளிடவும்.",
  },
  te: {
    ...enBase,
    tagline: "ప్రతి రైతుకు స్మార్ట్ దిగుబడి అంచనా",
    heroCta: "దిగుబడిని లెక్కించండి",
    cropType: "పంట రకం",
    selectCrop: "పంటను ఎంచుకోండి",
    rice: "బియ్యం",
    wheat: "గోధుమ",
    maize: "మొక్కజొన్న",
    others: "ఇతరవి",
    fieldSize: "భూమి పరిమాణం",
    unit: "ఒకకం",
    acres: "ఎకరాలు",
    gunthas: "గుంటలు",
    hectares: "హెక్టార్లు",
    location: "రైతు స్థానం",
    detectLocation: "జీపీఎస్ వాడండి",
    orEnterManually: "లేదా చేతితో నమోదు చేయండి",
    locationPlaceholder: "గ్రామం, పట్టణం లేదా జిల్లా",
    calculating: "లెక్కిస్తున్��ాం...",
    resultsTitle: "అంచనా దిగుబడి",
    suggestionsTitle: "దిగుబడిని మెరుగుపరచడానికి సూచనలు",
    fertilizerTips: "మట్టి పరీక్ష ఆధారంగా సమతుల ఎరువులు",
    irrigationTips: "కీలక దశల్లో నీరుపారుదల",
    rotationTips: "మట్టిని పుష్టిగా చేయడానికి పంట మార్పిడి",
    share: "షేర్",
    reset: "రీసెట్",
    gpsDenied: "లోకేషన్ అనుమతి నిరాకరించారు. చేతితో నమోదు చేయండి.",
  },
  mr: {
    ...enBase,
    tagline: "प्रत्येक शेतकऱ्यासाठी स्मार्ट उत्पादन अंदाज",
    heroCta: "उत्पादन मोजा",
    cropType: "पिकाचा प्रकार",
    selectCrop: "पीक निवडा",
    rice: "तांदूळ",
    wheat: "गहू",
    maize: "मका",
    others: "इतर",
    fieldSize: "शेतीचा आकार",
    unit: "एकक",
    acres: "एकर",
    gunthas: "गुंठ���",
    hectares: "हेक्‍टेर",
    location: "शेतकऱ्याचे ठिकाण",
    detectLocation: "GPS वापरा",
    orEnterManually: "किंवा हाताने भरा",
    locationPlaceholder: "गाव, शहर किंवा जिल्हा",
    calculating: "हिशोब चालू...",
    resultsTitle: "अंदाजित उत्पादन",
    suggestionsTitle: "उत्पादन सुधारण्यासाठी सूचना",
    fertilizerTips: "मृदा परीक्षणावर आधारित समतोल खते",
    irrigationTips: "महत्त्वाच्या टप्प्यांवर सिंचन",
    rotationTips: "माती सुपीकतेसाठी पीक फेरपालट",
    share: "शेअर",
    reset: "रीसेट",
    gpsDenied: "लोकेशन परवानगी नाकारली. हाताने भरा.",
  },
  gu: {
    ...enBase,
    tagline: "દરેક ખેડૂત માટે સ્માર્ટ ઉપજ અંદાજ",
    heroCta: "ઉપજ ગણો",
    cropType: "પાકનો પ્રકાર",
    selectCrop: "પાક પસંદ કરો",
    rice: "ચોખા",
    wheat: "ઘઉં",
    maize: "મકાઈ",
    others: "અન્ય",
    fieldSize: "ખેતરની સાઈઝ",
    unit: "એકમ",
    acres: "એકર",
    gunthas: "ગુઠ્ઠા",
    hectares: "હેક્ટર",
    location: "ખેડૂતનું સ્થળ",
    detectLocation: "GPS વાપરો",
    orEnterManually: "અથવા હાથથી દાખલ કરો",
    locationPlaceholder: "ગામ, શહેર અથવા జిల్లો",
    calculating: "ગણતરી થઈ રહી છે...",
    resultsTitle: "અંદાજિત પાક ઉપજ",
    suggestionsTitle: "ઉપજ સુધારવા માટે સૂચનો",
    fertilizerTips: "માટી તપાસ આધારિત સંતુલિત ખાતર",
    irrigationTips: "મહત્વના તબક્કે સિંચાઈ",
    rotationTips: "માટીને સમૃદ્ધ કરવા પાક ફરવણું",
    share: "શેર",
    reset: "રીસેટ",
    gpsDenied: "સ્થાનની પરવાનગી નકારી. કૃપા કરીને હાથથી દાખલ કરો.",
  },
  kn: {
    ...enBase,
    tagline: "ಪ್ರತಿ ರೈತನಿಗೂ ಸ್ಮಾರ್ಟ್ ಬೆಳೆ ಉತ್ಪಾದನೆ ಅಂದಾಜು",
    heroCta: "ಉತ್ಪಾದನೆ ಲೆಕ್ಕಿಸಿ",
    cropType: "ಬೆಳೆ ಪ್ರಕಾರ",
    selectCrop: "ಬೆಳೆ ಆಯ್ಕೆಮಾಡಿ",
    rice: "ಅಕ್ಕಿ",
    wheat: "ಗೋಧಿ",
    maize: "ಜೋಳ",
    others: "ಇತರೆ",
    fieldSize: "ಭೂಮಿ ಗಾತ್ರ",
    unit: "ಘಟಕ",
    acres: "ಏಕರ್",
    gunthas: "ಗುಂಠೆ",
    hectares: "ಹೆಕ್ಟೇರ್",
    location: "ರೈತನ ಸ್ಥಳ",
    detectLocation: "GPS ಬಳಸಿ",
    orEnterManually: "ಅಥವಾ ಕೈಯಾರೆ ನಮೂದಿಸಿ",
    locationPlaceholder: "ಹಳ್ಳಿ, ನಗರ ಅಥವಾ ಜಿಲ್ಲೆ",
    calculating: "ಲೆಕ್ಕಿಸಲಾಗುತ್ತಿದೆ...",
    resultsTitle: "ಅಂದಾಜಿತ ಬೆಳೆ ಉತ್ಪಾದನೆ",
    suggestionsTitle: "ಉತ್ಪಾದನೆ ಹೆಚ್ಚಿಸಲು ಸಲಹೆಗಳು",
    fertilizerTips: "ಮಣ್ಣಿನ ಪರೀಕ್ಷೆ ಆಧಾರಿತ ಸಮತೋಲನ ರಸಗೊಬ್ಬರ",
    irrigationTips: "ಮುಖ್ಯ ಹಂತಗಳಲ್ಲಿ ನೀರ��ವರಿ",
    rotationTips: "ಮಣ್ಣಿನ ಸಮೃದ್ಧಿಗಾಗಿ ಬೆಳೆ ಪರಿವರ್ತನೆ",
    share: "ಹಂಚಿಕೆ",
    reset: "ಮರುಹೊಂದಿಸಿ",
    gpsDenied: "ಸ್ಥಳ ಅನುಮತಿ ನಿರಾಕರಿಸಲಾಗಿದೆ. ಕೈಯಾರೆ ನಮೂದಿಸಿ.",
  },
  ml: {
    ...enBase,
    tagline: "ഓരോ കര്‍ഷകനും സ്മാര്‍ട്ട് വിളവുമാനം",
    heroCta: "വിളവ് കണക്കുകൂട്ടുക",
    cropType: "വിളയുടെ തരം",
    selectCrop: "വിള തിരഞ്ഞെടുക്കുക",
    rice: "അരി",
    wheat: "ഗോതമ്പ്",
    maize: "ചോളം",
    others: "മറ്റുള്ളവ",
    fieldSize: "വയലിന്റെ വലിപ്പം",
    unit: "യൂണിറ്റ്",
    acres: "ഏക്കർ",
    gunthas: "ഗുണ്ട",
    hectares: "ഹെക്ടർ",
    location: "കർഷകന്റെ സ്ഥാനം",
    detectLocation: "GPS ഉപയോഗിക്കുക",
    orEnterManually: "അല്ലെങ്കിൽ കൈകൊണ്ട് നൽകുക",
    locationPlaceholder: "ഗ്രാം, പട്���ണം അല്ലെങ്കിൽ ജില്ല",
    calculating: "കണക്കാക്കുന്നു...",
    resultsTitle: "അനുമാനിച്ച വിളവ്",
    suggestionsTitle: "വിളവ് വർദ്ധിപ്പിക്കാൻ നിർദേശങ്ങൾ",
    fertilizerTips: "മണ്ണ് പരിശോധനയെ അടിസ്ഥാനമാക്കി സമതുലിത വളങ്ങൾ",
    irrigationTips: "പ്രധാന ഘട്ടങ്ങളിൽ ജലസേചനം",
    rotationTips: "മണ്ണ് സമ്പുഷ്ടമാക്കാൻ വിളവറിപ്പ്",
    share: "പങ്കിടുക",
    reset: "റീസെറ്റ്",
    gpsDenied: "സ്ഥലാനుమതി നിഷേധിച്ചു. ദയവായി കൈകൊണ്ട് നൽകുക.",
  },
  pa: {
    ...enBase,
    tagline: "ਹਰ ਕਿਸਾਨ ਲਈ ਸਮਾਰਟ ਪੈਦਾਵਾਰ ਅੰਦਾਜ਼ਾ",
    heroCta: "ਪੈਦਾਵਾਰ ਗਿਣੋ",
    cropType: "ਫਸਲ ਦੀ ਕਿਸਮ",
    selectCrop: "ਫਸਲ ਚੁਣੋ",
    rice: "ਚੌਲ",
    wheat: "ਗੇਂਹੂਂ",
    maize: "ਮੱਕੀ",
    others: "ਹੋਰ",
    fieldSize: "���ੇਤ ਦਾ ਆਕਾਰ",
    unit: "ਇਕਾਈ",
    acres: "ਏਕੜ",
    gunthas: "ਗੁੰਠਾ",
    hectares: "ਹੈਕਟੇਅਰ",
    location: "ਕਿਸਾਨ ਦਾ ਟਿਕਾਣਾ",
    detectLocation: "GPS ਵਰਤੋ",
    orEnterManually: "ਜਾਂ ਹੱਥੋਂ ਦਰਜ ਕਰੋ",
    locationPlaceholder: "ਪਿੰਡ, ਸ਼ਹਿਰ ਜਾਂ ਜ਼ਿਲ੍ਹਾ",
    calculating: "ਹਿਸਾਬ ਹੋ ਰਿਹਾ ਹੈ...",
    resultsTitle: "ਅੰਦਾਜ਼ਿਤ ਪੈਦਾਵਾਰ",
    suggestionsTitle: "ਪੈਦਾਵਾਰ ਸੁਧਾਰ ਲਈ ਸੁਝਾਅ",
    fertilizerTips: "ਮਿੱਟੀ ਟੈਸਟ ਅਧਾਰਤ ਸੰਤੁਲਿਤ ਖਾਦਾਂ",
    irrigationTips: "ਮਹੱਤਵਪੂਰਣ ਪੜਾਅ 'ਤੇ ਸਿੰਚਾਈ",
    rotationTips: "ਮਿੱਟੀ ਨੂੰ ਸੰਭਣ ਲਈ ਫਸਲ ਬਦਲਾਅ",
    share: "ਸ਼ੇਅਰ",
    reset: "ਰੀਸੈਟ",
    gpsDenied: "ਟਿਕਾਣੇ ਦੀ ਇਜਾਜ਼ਤ ਰੱਦ। ਕਿਰਪਾ ਕਰਕੇ ਹੱਥੋਂ ਦਰਜ ਕਰੋ.",
  },
  or: {
    ...enBase,
    tagline: "ପ୍ରତ୍ୟେକ କୃଷକ ପାଇଁ ସ୍ମାର୍ଟ ଉପଜ ଅନୁମାନ",
    heroCta: "ଉପଜ ଗଣନା କରନ୍ତୁ",
    cropType: "ଚାଷ ଧରଣ",
    selectCrop: "ଚାଷ ଚୟନ କରନ୍ତୁ",
    rice: "ଚାଉଳ",
    wheat: "ଗହୁଁ",
    maize: "ମକା",
    others: "ଅନ୍ୟ",
    fieldSize: "ଜମି ଆକାର",
    unit: "ଏକକ",
    acres: "ଏକର",
    gunthas: "ଗୁଣ୍ଠା",
    hectares: "ହେକ୍ଟର",
    location: "କୃଷକଙ୍କ ଅବସ୍ଥାନ",
    detectLocation: "GPS ବ୍ୟବହାର କରନ୍ତୁ",
    orEnterManually: "କିମ୍ବା ହାତରେ ଦିଅନ୍ତୁ",
    locationPlaceholder: "ଗ୍ରାମ, ସହର କିମ୍ବା ଜିଲ୍ଲା",
    calculating: "ଗଣନା ହେଉଛି...",
    resultsTitle: "ଅନୁମାନିତ ଉପଜ",
    suggestionsTitle: "ଉପଜ ବଢାଇବା ପାଇଁ ପରାମର୍ଶ",
    fertilizerTips: "ମାଟି ପରୀକ୍ଷା ଆଧାରିତ ସମତୋଳ ସର",
    irrigationTips: "ଗୁରୁତ୍ୱପୂର୍ଣ୍ଣ ପର୍ଯ୍ୟାୟରେ ସିଚାଇ",
    rotationTips: "ମାଟି ସମୃଦ୍ଧି ପାଇଁ ଫସଲ ପରିବର୍ତ୍ତନ",
    share: "ସେୟାର",
    reset: "ରିସେଟ",
    gpsDenied: "ଲୋକେସନ୍ ଅନୁମତି ନାକଚ। ହାତରେ ଦିଅନ୍ତୁ.",
  },
  ur: {
    ...enBase,
    tagline: "ہر کسان کے لیے اسمارٹ پیداوار کا تخمینہ",
    heroCta: "پیداوار شمار کریں",
    cropType: "فصل کی قسم",
    selectCrop: "فصل منتخب کریں",
    rice: "چاول",
    wheat: "گندم",
    maize: "مکئی",
    others: "دیگر",
    fieldSize: "کھیت کا سائز",
    unit: "اکائی",
    acres: "ایکڑ",
    gunthas: "گنٹھہ",
    hectares: "ہیکٹر",
    location: "کسان کا مقام",
    detectLocation: "GPS استعمال کریں",
    orEnterManually: "یا دستی طور پر درج کریں",
    locationPlaceholder: "گاؤں، قصبہ یا ضلع",
    calculating: "حساب ہو رہا ہے...",
    resultsTitle: "متوقع پیداوار",
    suggestionsTitle: "پیداوار بہتر بنانے کے مشورے",
    fertilizerTips: "مٹی کے ٹیسٹ پر مبنی متوازن کھاد",
    irrigationTips: "اہم مراحل پر آبپاشی",
    rotationTips: "زمین کی زرخیزی کے لیے فصل کی تبدیلی",
    share: "شیئر",
    reset: "ری سیٹ",
    gpsDenied: "مقام کی اجازت مسترد۔ براہ کرم دستی طور پر درج کریں۔",
  },
  as: undefined,
  brx: undefined,
  doi: undefined,
  ks: undefined,
  kok: undefined,
  mai: undefined,
  mni: undefined,
  ne: undefined,
  sa: undefined,
  sat: undefined,
  sd: undefined,
};

const LANGUAGE_LIST: { code: Locale; name: string }[] = [
  { code: "en", name: "English" },
  { code: "hi", name: "हिन्दी" },
  { code: "bn", name: "বাংলা" },
  { code: "ta", name: "தமிழ்" },
  { code: "te", name: "తెలుగు" },
  { code: "mr", name: "मराठी" },
  { code: "gu", name: "ગુજરાતી" },
  { code: "kn", name: "ಕನ್ನಡ" },
  { code: "ml", name: "മലയാളം" },
  { code: "pa", name: "ਪੰਜਾਬੀ" },
  { code: "or", name: "ଓଡ଼ିଆ" },
  { code: "ur", name: "اردو" },
  { code: "as", name: "অসমীয়া" },
  { code: "brx", name: "बोड़ो" },
  { code: "doi", name: "डोगरी" },
  { code: "ks", name: "کٲشُر" },
  { code: "kok", name: "कोंकणी" },
  { code: "mai", name: "मैथिली" },
  { code: "mni", name: "ꯃꯤꯇꯩꯂꯣꯟ" },
  { code: "ne", name: "नेपाली" },
  { code: "sa", name: "संस्कृतम्" },
  { code: "sat", name: "ᱥᱟᱱᱛᱟᱞᱤ" },
  { code: "sd", name: "سنڌي" },
];

const I18nContext = createContext<I18nContextType | undefined>(undefined);

export function I18nProvider({ children }: PropsWithChildren) {
  const [locale, setLocale] = useState<Locale>(() => {
    const stored = typeof window !== "undefined" ? (localStorage.getItem("locale") as Locale | null) : null;
    return stored || "en";
  });

  useEffect(() => {
    try { localStorage.setItem("locale", locale); } catch {}
  }, [locale]);

  const t = useMemo(() => {
    const dict = dictionaries[locale] ?? enBase;
    return (key: string) => (dict && dict[key]) || enBase[key] || key;
  }, [locale]);

  return (
    <I18nContext.Provider value={{ locale, setLocale, t, languages: LANGUAGE_LIST }}>
      {children}
    </I18nContext.Provider>
  );
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error("useI18n must be used within I18nProvider");
  return ctx;
}
